Алгоритм лексера я взял с этой статьи, он удобный и быстро работающий. https://habr.com/ru/post/206320/